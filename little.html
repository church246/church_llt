<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>抽獎箱動畫 — 許多球跑動</title>
<style>
  body{margin:0;font-family:sans-serif;background:#071026;color:#e6eef8}
  .wrap{max-width:1100px;margin:18px auto;padding:18px}
  h1{margin:0 0 12px;font-size:1.25rem}
  .controls{display:flex;gap:10px;align-items:center;margin-bottom:12px}
  button{padding:10px 14px;border-radius:10px;border:0;background:#35d0ff;color:#04232f;font-weight:700;cursor:pointer}
  button.ghost{background:transparent;color:#e6eef8;border:1px solid rgba(255,255,255,.2)}
  .canvas-wrap{position:relative;border-radius:12px;overflow:hidden;background:#0b1626;box-shadow:0 10px 30px rgba(0,0,0,.5)}
  canvas{display:block;width:100%;height:600px}
  .picked-list{position:absolute;right:12px;bottom:12px;background:rgba(0,0,0,0.35);padding:8px;border-radius:8px;max-width:320px}
  .picked-item{display:inline-block;padding:6px 10px;margin:4px;border-radius:999px;background:rgba(255,255,255,0.05);font-weight:700}
  #results{margin-top:16px;padding:12px;background:rgba(255,255,255,0.05);border-radius:8px}
  .round{margin-bottom:8px}
  .round strong{margin-right:6px;color:#35d0ff}
   #pickedChips {
    display: none;
  }
</style>
</head>
<body>
<div class="wrap">
  <h1>抽獎箱動畫（932～1082）</h1>
  <div class="controls">
    <button id="drawBtn">開始抽獎（抽 20 顆）</button>
    <button id="resetBtn" class="ghost">全部重置</button>
  </div>

  <div class="canvas-wrap" id="box">
    <canvas id="c"></canvas>
    <div class="">
        <!-- <strong>已抽</strong> -->
        <div id="pickedChips"></div>
    </div>
  </div>

  <div id="results">
    <h3>抽獎結果</h3>
    <div id="rounds"></div>
  </div>
</div>

<script>
const MIN=932,MAX=1082,BATCH=20;
const canvas=document.getElementById('c'),ctx=canvas.getContext('2d',{alpha:false});
let W=1200,H=600;function resize(){const dpr=window.devicePixelRatio||1;W=canvas.clientWidth=canvas.parentElement.clientWidth;H=600;canvas.width=W*dpr;canvas.height=H*dpr;ctx.setTransform(dpr,0,0,dpr,0,0);}window.addEventListener('resize',resize);resize();
const COLORS=['#f97316','#fb7185','#60a5fa','#34d399','#f43f5e','#a78bfa','#f59e0b','#06b6d4'];
class Ball{constructor(num,x,y,vx,vy,r=20){this.num=num;this.x=x;this.y=y;this.vx=vx;this.vy=vy;this.r=r;this.color=COLORS[Math.floor(Math.random()*COLORS.length)];this.isPicked=false;this.flashTimer=0;}draw(){ctx.beginPath();ctx.fillStyle=this.color;ctx.globalAlpha=this.isPicked?0.25:1;ctx.arc(this.x,this.y,this.r,0,Math.PI*2);ctx.fill();ctx.globalAlpha=1;ctx.fillStyle='#021017';ctx.font=`${this.r*0.6}px sans-serif`;ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText(this.num,this.x,this.y);}step(dt){if(this.isPicked)return;this.x+=this.vx*dt;this.y+=this.vy*dt;if(this.x<this.r||this.x>W-this.r)this.vx*=-1;if(this.y<this.r||this.y>H-this.r)this.vy*=-1;}}
let allNumbers=[];for(let i=MIN;i<=MAX;i++)allNumbers.push(i);
let balls=[];function initBalls(){balls=[];for(const num of allNumbers){const r=18+Math.random()*6;const x=r+Math.random()*(W-2*r);const y=r+Math.random()*(H-2*r);const sp=40+Math.random()*60;const a=Math.random()*Math.PI*2;balls.push(new Ball(num,x,y,Math.cos(a)*sp,Math.sin(a)*sp,r));}}
function update(dt){for(const b of balls)b.step(dt);}function render(){ctx.fillStyle='#071226';ctx.fillRect(0,0,W,H);for(const b of balls)b.draw();}
let last=performance.now();function loop(t){const dt=(t-last)/1000;last=t;update(dt);render();requestAnimationFrame(loop);}initBalls();requestAnimationFrame(loop);

function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}
const chips=document.getElementById('pickedChips');const rounds=document.getElementById('rounds');let round=0;
async function draw(){const pool=balls.filter(b=>!b.isPicked);if(pool.length===0){alert('沒有球可抽了');return;}shuffle(pool);const take=Math.min(BATCH,pool.length);const selected=pool.slice(0,take);round++;const nums=[];for(const b of selected){b.isPicked=true;const span=document.createElement('span');span.className='picked-item';span.textContent=b.num;chips.prepend(span);nums.push(b.num);}nums.sort((a,b)=>a-b);const div=document.createElement('div');div.className='round';div.innerHTML=`<strong>第 ${round} 輪：</strong> ${nums.join(', ')}`;rounds.prepend(div);}
document.getElementById('drawBtn').onclick=draw;
document.getElementById('resetBtn').onclick=()=>{if(confirm('確定重置？')){chips.innerHTML='';rounds.innerHTML='';round=0;initBalls();}};
</script>
</body>
</html>


